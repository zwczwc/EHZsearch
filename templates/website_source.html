{% load staticfiles %}
<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
    <style>
        .searchEch {
            position: absolute;
            left: 20px;
            top: 5px;
            z-index: 1;
        }
        input, button {
            border-radius: 5px;
            font-size: 14px;
            line-height: 25px;
            border: 1px solid darkgrey;
            outline: none;
        }
        input{
            text-indent: 0.5em
        }
        button {
            cursor: pointer
        }
        button:hover{
            color: #fff;
            background-color: #19a9d5
        }

    </style>
</head>

<body style="height: 100%; margin: 0">
    <div class="searchEch">
        <input type="text" id="inpVal" value="" placeholder="" autocomplete="off"/>
        <button id="searchVal">查看</button>
    </div>
    <div id="container" style="height: 100%"></div>
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/echarts.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/apiMap.js' %}"></script>
    <script type="text/javascript">

        var dom = document.getElementById("container");

        var searchValueRel = localStorage.getItem("searchValue");
        $("#inpVal").attr("placeholder", searchValueRel)

        var oinpVal = ""

        $("#searchVal").click(function () {
            oinpVal = $("#inpVal").val();
            if (oinpVal != "") {
                searchValueRel = oinpVal;
                getEchartData()
            } else {
                alert("请输入内容")
            }
        });

        var myChart = echarts.init(dom);
        var app = {};  //图的标题 可以赋值
        option = null;
        myChart.showLoading();

        jobTypeData = null
        cityData = null

        window.onresize = function () {
            myChart.resize();
        }

        function getEchartData() {
            $.get('/getSourceChartByKeyword?kw=' + searchValueRel, function (avgWage) {
                console.log(searchValueRel,avgWage)

                // 如果后端返回有东西
                // if() {

                // }

                myChart.hideLoading();
                jobTypeData = avgWage;

                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                            label: {
                                show: true
                            }
                        }
                    },
                    title: {
                        left: 'center',
                        text: searchValueRel + '网站来源图',
                        // textStyle:{color:'#23b7e5'}
                    },
                    toolbox: {
                        show: true,
                        feature: {
                            mark: { show: true },
                            dataView: { show: true, readOnly: false },
                            magicType: { show: true, type: ['line', 'bar'] },
                            restore: { show: true },
                            saveAsImage: { show: true }
                        }
                    },
                    calculable: true,
                    legend: {
                        data: ['岗位平均工资', '城市平均工资'],
                        selected: {
                            '岗位平均工资': true,
                            '城市平均工资': false
                            //                'Growth':false
                        },
                        itemGap: 5
                    },
                    grid: {
                        top: '12%',
                        left: '2%',
                        right: '10%',
                        containLabel: true
                    },
                    xAxis: [
                        {
                            type: 'category',
                            data: avgWage.source
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            // name: searchValueRel + '网站来源',
                            axisLabel: {
                                formatter: function (a) {
                                    a = +a;
                                    return isFinite(a)
                                        ? echarts.format.addCommas(+a / 1)
                                        : '';
                                }
                            },
                            // 不出现小数点
                            minInterval: 1,
                            boundaryGap: [0, 0.1]
                        }
                    ],
                    dataZoom: [
                        {
                            show: true,
                            start: 0,
                            end: 100
                        },
                        {
                            type: 'inside',
                            start: 94,
                            end: 100
                        },
                        {
                            show: true,
                            yAxisIndex: 0,
                            filterMode: 'empty',
                            width: 5,
                            height: '80%',
                            showDataShadow: false,
                            left: '93%'
                        }
                    ],
                    series: [
                        {
                            name: '网站来源',
                            type: 'bar',
                            data: avgWage.total
                        },
                        // {
                        //     name: '网站来源',
                        //     type: 'bar',
                        //     itemStyle: {
                        //         normal: {
                        //             // color:function(d){return "#"+Math.floor(Math.random()*(256*256*256-1)).toString(16);},
                        //             color: '#23b7e5',
                        //             label: {
                        //                 show: true,
                        //                 position: 'top',
                        //             }
                        //         }
                        //     },
                        //     data: avgWage.AvgWage
                        // }
                    ]
                };
                myChart.setOption(option);
            });
        }
        getEchartData()

        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
    </script>
</body>








</html>